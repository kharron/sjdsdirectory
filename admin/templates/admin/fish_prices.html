<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Admin</title>


	<!-- Stylesheets -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/style.css">

	<!-- GOOGLE FONTS -->
	<link href='http://fonts.googleapis.com/css?family=Raleway:400,700,600,800%7COpen+Sans:400italic,400,600,700' rel='stylesheet' type='text/css'>


	<!--[if IE 9]>
		<script src="js/media.match.min.js"></script>
	<![endif]-->
</head>

<body>
<div id="main-wrapper">

	<header id="header">
		<div class="header-top-bar">
			<div class="container">
				<!-- HEADER-LOGIN -->
				<div class="header-login">

					<a href="#" class=""><i class="fa fa-power-off"></i> Login</a>

					<div>
						<form action="#">
							<input type="text" class="form-control" placeholder="Username">
							<input type="password" class="form-control" placeholder="Password">
							<input type="submit" class="btn btn-default" value="Login">
							<a href="#" class="btn btn-link">Forgot Password?</a>
						</form>
					</div>

				</div> <!-- END .HEADER-LOGIN -->

				<!-- HEADER REGISTER -->
				<div class="header-register">
					<a href="#" class=""><i class="fa fa-plus-square"></i> Register</a>

					<div>
						<form action="#">
							<input type="text" class="form-control" placeholder="Username">
							<input type="email" class="form-control" placeholder="Email">
							<input type="password" class="form-control" placeholder="Password">
							<input type="submit" class="btn btn-default" value="Register">
						</form>
					</div>

				</div> <!-- END .HEADER-REGISTER -->

				<!-- HEADER-LOG0 -->
				<div class="header-logo text-center">
					<h2><a href="index.html">GL<i class="fa fa-globe"></i>BO</a></h2>
				</div>
				<!-- END HEADER LOGO -->

				<!-- HEADER-SOCIAL -->
				<div class="header-social">
					<a href="#">
						<span><i class="fa fa-share-alt"></i></span>
						<i class="fa fa-chevron-down social-arrow"></i>
					</a>

					<ul class="list-inline">
						<li class="active"><a href="#"><i class="fa fa-facebook-square"></i></a></li>
						<li><a href="#"><i class="fa fa-google-plus-square"></i></a></li>
						<li><a href="#"><i class="fa fa-twitter-square"></i></a></li>
						<li><a href="#"><i class="fa fa-linkedin-square"></i></a></li>
					</ul>
				</div>
				<!-- END HEADER-SOCIAL -->

				<!-- HEADER-LANGUAGE -->
				<div class="header-language">
					<a href="#">
						<span>EN</span>
						<i class="fa fa-chevron-down"></i>
					</a>

					<ul class="list-unstyled">
						<li class="active"><a href="#">EN</a></li>
						<li><a href="#">FR</a></li>
						<li><a href="#">PT</a></li>
						<li><a href="#">IT</a></li>
					</ul>
				</div> <!-- END HEADER-LANGUAGE -->

				<!-- CALL TO ACTION -->
				<div class="header-call-to-action">
					<a href="#" class="btn btn-default"><i class="fa fa-plus"></i> Add Listing</a>
				</div><!-- END .HEADER-CALL-TO-ACTION -->

			</div><!-- END .CONTAINER -->
		</div>
		<!-- END .HEADER-TOP-BAR -->

		<!-- HEADER SEARCH SECTION -->
		<div class="header-search fixed-height">
			<div class="header-search-bar">
        <form action="#">

          <div class="search-toggle">
            <div class="container">
              <div class="distance-range">
                <p>
                  <label for="amount-search">Distance:</label>
                  <input type="text" id="amount-search">
                </p>

                <div id="slider-range-search"></div>
              </div>  <!-- end #distance-range -->

              <div class="distance-range">
                <p>
                  <label for="amount-search">Days published:</label>
                  <input type="text" id="amount-search-day">
                </p>

                <div id="slider-range-search-day"></div>
              </div>  <!-- end #distance-range -->

              <p>Location:</p>
              <div class="select-country">
                <select class="" data-placeholder="-Select Country-">
                  <option value="option1">option 1</option>
                  <option value="option2">option 2</option>
                  <option value="option3">option 3</option>
                </select>
              </div>

              <div class="region">
                <input type="text" placeholder="-Region-">
              </div>

              <div class="address">
                <input type="text" placeholder="-Address-">
              </div>

              <div class="category-search">
                <select class="" data-placeholder="-Select category-">
                  <option value="option1">option 1</option>
                  <option value="option2">option 2</option>
                  <option value="option3">option 3</option>
                </select>
              </div>

              <button class="search-btn" type="submit"><i class="fa fa-search"></i></button>

            </div>
          </div>  <!-- END .search-toggle -->


          <div class="container">
            <button class="toggle-btn" type="submit"><i class="fa fa-bars"></i></button>

            <div class="search-value">
              <div class="keywords">
                <input type="text" class="form-control" placeholder="Keywords">
              </div>

              <div class="select-location">
                <select class="" data-placeholder="-Select location-">
                  <option value="option1">option 1</option>
                  <option value="option2">option 2</option>
                  <option value="option3">option 3</option>
                  <option value="option4">option 4</option>
                </select>
              </div>

              <div class="category-search">
                <select class="" data-placeholder="-Select category-">
                  <option value="option1">option 1</option>
                  <option value="option2">option 2</option>
                  <option value="option3">option 3</option>
                  <option value="option4">option 4</option>
                </select>
              </div>

              <button class="search-btn" type="submit"><i class="fa fa-search"></i></button>
            </div>
          </div> <!-- END .CONTAINER -->
        </form>
      </div> <!-- END .header-search-bar -->

			<div class="page-heading about-us-heading">
				<span></span> <!-- for dark-overlay on the bg -->

				<div class="container">
					<h1>Admin <span>SJDS</span></h1>

					<div class="heading-link">
						<a href="/admin/">Admin Home</a>

						<i>/</i>

						<a href="#">Admin</a>
					</div>

				</div> <!-- END .container-->
			</div> <!-- END .about-us-heading -->

		</div> <!-- END .SEARCH and slide-section -->


		<div class="header-nav-bar">
			<div class="container">
				<nav>

					<button><i class="fa fa-bars"></i></button>

					<ul class="primary-nav list-unstyled">
						<li><a href="/admin/">Admin Home</a>
						</li>

						<li class=""><a href="/admin/cats/">Categories</a>
						</li>

						<li class="">
							<a href="#">Events<i class="fa fa-angle-down"></i></a>

							<ul>
								<li><a href="/admin/fish_prices/">Fish Prices</a></li>
							</ul>

						</li>

					</ul>
				</nav>
			</div> <!-- end .container -->
		</div> <!-- end .header-nav-bar -->
	</header> <!-- end #header -->

	<div id="page-content">
		<div class="container">
			<div class="page-content">
				<div class="row">
				<div class="row">
					<h2 class="fish-header">Fish Prices</h2>
					<div class="row">
						<div class="col-sm-3"><h4>Fish Name (english)</h4></div>
						<div class="col-sm-3"><h4>Fish Name (spanish)</h4></div>
						<div class="col-sm-3"><h4>Price</h4></div>
						<div class="col-sm-3"><h4>Date</h4></div>
					</div>
					<div class="row">
					{% for fish in fishies %}
						<div class="col-sm-3">{{ fish.name_english }}</div>
						<div class="col-sm-3">{{ fish.name_spanish }}</div>
						<div class="col-sm-3">{{ fish.price }}</div>
						<div class="col-sm-3">
							{{ fish.date }}
							<a href="/admin/delfish/{{ fish.id }}"><button type="button" class="btn btn-danger">Delete Fish</button></a> 
						</div>
					{% endfor %}
					</div>
					<div class="row">
					
						<form class="form-horizontal" action="/admin/addfish/" method="POST" enctype="multipart/form-data" id="fishform">
							{% csrf_token %}
							<div class="col-sm-3">
								<p>Fish (English)</p>
								<input class="form-control" name="fishname_english" type="text" id="fishname_english" />
							</div>
							<div class="col-sm-3">
								<p>Fish (Spanish)</p>
								<input class="form-control" name="fishname_spanish" type="text" id="fishname_spanish" />
							</div>
							<div class="col-sm-3">
								<p>Description</p>
								<input class="form-control" name="fish_description" type="text" id="fish_description" />
							</div>
							<div class="col-sm-3">
								<p>Price / lb</p>
								<input class="form-control" name="price" type="text" id="price" />
							</div>
							<div class="col-sm-12 fish_button">
								<button type="submit" id="fish_submit" class="btn btn-primary">Add Fish</button>
							</div>

						</form>
					</div>

				</div> <!-- end .add-fishform -->
			</div> <!-- end .page-content -->
		</div> <!-- end .container -->

	</div> <!-- end #page-content -->


	<footer id="footer">
		<div class="main-footer">

			<div class="container">
				<div class="row">

					<div class="col-md-3 col-sm-6">
						<div class="about-globo">
							<h3>About Globo</h3>

							<div class="footer-logo">
								<a href="#"><img src="img/footer_logo.png" alt=""></a>
								<span></span> <!-- This content for overlay effect -->
							</div>

							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Proin nibh augue,
								suscipit a, scelerisque sed, lacinia in, mi. Cras vel lorem.</p>

						</div> <!-- End .about-globo -->
					</div> <!-- end Grid layout-->

					<div class="col-md-3 col-sm-6">
						<h3>Latest From Blog</h3>

						<div class="latest-post clearfix">
							<div class="post-image">
								<img src="img/content/latest_post_1.jpg" alt="">

								<p><span>12</span>Sep</p>
							</div>

							<h4><a href="#">Post Title Goes Here</a></h4>

							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p>
						</div>

						<div class="latest-post clearfix">
							<div class="post-image">
								<img src="img/content/latest_post_2.jpg" alt="">

								<p><span>09</span>Sep</p>
							</div>

							<h4><a href="#">Post Title Goes Here</a></h4>

							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p>
						</div>
					</div> <!-- end Grid layout-->

					<div class="col-md-3 col-sm-6 clearfix">
						<div class="popular-categories">
							<h3>Popular Categories</h3>

							<ul>
								<li><a href="#"><i class="fa fa-shopping-cart"></i>E-commerce</a></li>
								<li><a href="#"><i class="fa fa-paper-plane-o"></i>Entertainment</a></li>
								<li><a href="#"><i class="fa fa-cogs"></i>Industry</a></li>
								<li><a href="#"><i class="fa fa-book"></i>Libraries &amp; Public Office</a></li>
								<li><a href="#"><i class="fa fa-building-o"></i>Real Estate</a></li>
							</ul>
						</div> <!-- end .popular-categories-->
					</div> <!-- end Grid layout-->

					<div class="col-md-3 col-sm-6">
						<div class="newsletter">
							<h3>Newsletter</h3>

							<form action="#">
								<input type="Email" placeholder="Email address">
								<button><i class="fa fa-plus"></i></button>
							</form>

							<h3>Keep In Touch</h3>

							<ul class="list-inline">
								<li><a href="#"><i class="fa fa-facebook"></i></a></li>
								<li><a href="#"><i class="fa fa-twitter"></i></a></li>
								<li><a href="#"><i class="fa fa-google-plus"></i></a></li>
								<li><a href="#"><i class="fa fa-linkedin"></i></a></li>
							</ul>
						</div> <!-- end .newsletter-->

					</div> <!-- end Grid layout-->
				</div> <!-- end .row -->
			</div> <!-- end .container -->
		</div> <!-- end .main-footer -->

		<div class="copyright">
			<div class="container">
				<p>Copyright 2015 &copy; SJDS Directory. All rights reserved. Powered by  <a href="#">Kharron</a></p>

				<ul class="list-inline">
					<li><a href="#">Home</a></li>
					<li><a href="#">About Us</a></li>
					<li><a href="#">Blog</a></li>
					<li><a href="#">Pricing</a></li>
					<li><a href="#">Contact</a></li>
				</ul>
			</div> <!-- END .container -->
		</div> <!-- end .copyright-->
	</footer> <!-- end #footer -->

</div> <!-- end #main-wrapper -->

<!-- Scripts -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
<script src="/static/js/jquery.ba-outside-events.min.js"></script>
<script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=true"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/owl.carousel.js"></script>
<script src="/static/js/scripts.js"></script>
<script>

	 function update_bizlist(cat_json, div_name){
		$("#"+ div_name).replaceWith('<select id="' + div_name + '" name="bCategory" class="form-control input-border">');
			for (i=0; i<cat_json['count']; i++){
			 $("#"+ div_name).append("<option value='" + cat_json[i]['id'] + "'>" + cat_json[i]['name'] + "</option>");
			};
		 $('#'+ div_name).append("</select>");
	 }

	 function update_catlist(cat_json, div_name){
		 keys_arr = Object.keys(cat_json);
		 $("#"+ div_name).replaceWith('<select id="' + div_name + '" name="bCategory" class="form-control input-border"><option value="00">Select a category</option>');
			keys_arr.forEach(function(i){
			 $("#"+ div_name).append("<option value='" + i + "'>" + cat_json[i] + "</option>");
			});
		 $('#'+ div_name).append("</select>");
	 }


	 function get_biz_list(){
		$("#place_select2").replaceWith("<span id='place_select2' class='spinner'></span>");
		$.ajax({
			'type': 'GET',
			'url': 'http://api.sjdsdirectory.com/getbusinesses_order/',
			'success': function(list){
				cat_json = JSON.parse(list);
				update_bizlist(cat_json, 'place_select2');
			}
		});
	 }

	 function get_cat_list(){
		$("#place_select").replaceWith("<span id='place_select' class='spinner'></span>");
		$.ajax({
			'type': 'GET',
			'url': 'http://api.sjdsdirectory.com/getcats/',
			'success': function(list){
				cat_json = JSON.parse(list);
				update_catlist(cat_json, 'place_select');
			}
		});
	 }

	function add_photos(photo_arr, bid){
		arr = photo_arr;
		html = '';
		for (i=0; i<arr.length; i++){
			html += "<img src='/media/business_images/" + bid + "/" + arr[i] + "' style='margin-left: 20px; max-width: 200px;' />";
		}
		$("#bPic1").parent().parent().prepend(html);
	}

	function get_biz(bid){
		 bid = encodeURIComponent(bid);
		 $.ajax({
			 type: 'POST',
			 url: 'http://api.sjdsdirectory.com/editbusiness/',
			 data: 'bid=' + bid,
			 success: function(msg){
				 // Change to Edit Cat
				 biz_info = JSON.parse(msg);
				 prod_arr = biz_info['products'];
				 photo_arr = biz_info['photos'];
				 $("#bProducts").val(prod_arr);
				 $("#bName").val(biz_info['name']);
				 $("#bDesc").val(biz_info['description']);
				 $("#bPhone").val(biz_info['phone']);
				 $("#bAltPhone").val(biz_info['alt_phone']);
				 $("#bAltPhone2").val(biz_info['alt2_phone']);
				 $("#bEmail").val(biz_info['email']);
				 $("#bWebsite").val(biz_info['website']);
				 $("#facebook").val(biz_info['facebook']);
				 $("#twitter").val(biz_info['twitter']);
				 if (biz_info['take_credit'] == 1){
					 $("#bTakeCredit").prop('checked', true);
				 } else {
					 $("#bTakeCredit2").prop('checked', true); 
				 }
				 $("#bLat").val(biz_info['gps_lat']);
				 $("#bLon").val(biz_info['gps_long']);
				 //$("#place_select").prepend('<option value="' + biz_info['cat_info']['id'] + '" selected>' + biz_info['cat_info']['name'] + '</option>');
				 $("#hidden-bid").val(biz_info['id']); 
				 $("#addbtn").attr("id", "updatebtn");
				 $("#updatebtn").html('Update Business');
				 $("#addform").attr("action", "/updatebusiness/")
				 if (biz_info['cat_info']){
					 // place categories above category drop down.
					 keys_arr = Object.keys(biz_info['cat_info']['name']);
					 keys_arr.forEach(function(i){
						 $("#category_list").before('<a href="/delete_from_cat/' + biz_info['cat_info']['name'][i]['id'] + '/"><button class="cat_button btn btn-success" type="button"><i class="glyphicon glyphicon-remove"></i> ' + biz_info['cat_info']['name'][i]['name'] + '</button></a>'); 
					 });
					 $("#category_list").append("<br /><br />");
					 
				 }
				 if (photo_arr){
				   add_photos(photo_arr, biz_info['id']);
				 }
				 loadMarker(biz_info['gps_lat'], biz_info['gps_long']);
			 }
		 });
	 }

	$(document).ready(function(){
		get_biz_list();
		get_cat_list();

		$("#fish_button").click(function(){
			$("#fishform").submit();
		});

		$("body").on("change", "#place_select", function(){
			$("#hidden-category").attr("value",$("#place_select").val());
		});

		$("body").on("click", "#updatebtn2", function(e){
			e.preventDefault();
			var bName = encodeURIComponent($("#bName").val());
			var bDesc = encodeURIComponent($("#bDesc").val());
			var bEmail = encodeURIComponent($("#bEmail").val());
			var bWebsite = encodeURIComponent($("#bWebsite").val());
			var facebook = encodeURIComponent($("#facebook").val());
			var twitter = encodeURIComponent($("#twitter").val());
			if ($("#bTakeCredit").is(":checked")){
				take_credit = 1;
			} else {
				take_credit = 0;
			}
			var bLat = $("#bLat").val();
			var bLon = $("#bLon").val();
			var bCategory = $("#hidden_category").val();
			var bPhone = $("#bPhone").val();
			var bAltPhone = $("#bAltPhone").val();
			var bAltPhone2 = $("#bAltPhone2").val();
			var bProducts = $("#bProducts").val();
			var bid = $("#hidden-bid").val();
			data = "bid=" + bid + "&bName=" + bName + "&bDesc=" + bDesc + "&bEmail=" + bEmail + "&bWebsite=" + bWebsite + "&bLat=" + bLat + "&bLon=" + bLon + "&hidden_category=" + bCategory + "&bPhone=" + bPhone + "&bAltPhone=" + bAltPhone + "&bAltPhone2=" + bAltPhone + "&bProducts=" + bProducts + "&facebook=" + facebook + "&twitter=" + twitter + "&bTakeCredit=" + take_credit;
			$.ajax({
				"type": "POST",
				"url": "http://api.sjdsdirectory.com/updatebusiness/",
				"data": data,
				"success": function(msg){
					window.location.replace("/admin/");
				}
			});
		});

	  $("body").on("click", "#addbtn2", function(e){
			e.preventDefault();
			var bName = encodeURIComponent($("#bName").val());
			var bDesc = encodeURIComponent($("#bDesc").val());
			var bEmail = $("#bEmail").val();
			var bWebsite = $("#bWebsite").val();
			var facebook = $("#facebook").val();
			var twitter = $("#twitter").val();
			var bLat = $("#bLat").val();
			var bLon = $("#bLon").val();
			var bCategory = $("#place_select").val();
			var bPhone = $("#bPhone").val();
			var bAltPhone = $("#bAltPhone").val();
			var bAltPhone2 = $("#bAltPhone2").val();
			var bProducts = encodeURIComponent($("#bProducts").val());
			data = "bName=" + bName + "&bDesc=" + bDesc + "&bEmail=" + bEmail + "&bWebsite=" + bWebsite + "&bLat=" + bLat + "&bLon=" + bLon + "&bCategory=" + bCategory + "&bPhone=" + bPhone + "&bAltPhone=" + bAltPhone + "&bAltPhone2=" + bAltPhone + "&bProducts=" + bProducts + "&facebook=" + facebook + "&twitter=" + twitter;
			$.ajax({
				"type": "POST",
				"url": "http://api.sjdsdirectory.com/addbusiness/",
				"data": data,
				"success": function(msg){
					alert('Added with id: ' + msg);
				}
			})

		});

		$("#editbtn").click(function(e){
			e.preventDefault();
			bid = $("#place_select2").val();
			get_biz(bid);
		})

		$("#delbtn").click(function(e){
		// Delete a particular business
			e.preventDefault();
			var select = document.getElementById( "place_select2" );
			if (confirm('Are you sure you want to delete')) {
			var bid = select.options[select.selectedIndex].value;
			$.ajax({
				"type": "GET",
				"url": "http://api.sjdsdirectory.com/deletebusiness/" + bid + "/",
				"success": function(msg){
					if (msg == 1){
						alert("Deleted");
						get_biz_list();
					} else {
						alert(msg);
					}
				}
			})
			} else {
				//Do Nothing
			}
		});
	});
</script>

</body>
</html>
